---
deployment:
  tasks:
    - /bin/bash -lc "python3 -m venv .venv || true"
    - /bin/bash -lc "source .venv/bin/activate && pip install --upgrade pip setuptools wheel"
    - /bin/bash -lc "source .venv/bin/activate && pip install -r requirements.txt || true"
    - /bin/bash -lc "# Ensure uploads and backups dirs exist"
    - /bin/bash -lc "mkdir -p uploads backups"

hooks:
  build: |
    echo "Build completed"

application:
  type: "python"
  path: "."
  # Export USE_FALLBACK=1 to force the lightweight Flask fallback on hosts
  # that cannot install numpy/pandas. If you prefer Passenger, Passenger will
  # automatically use passenger_wsgi.py in the repo root (no explicit run cmd
  # required). The following run command activates the venv and starts
  # gunicorn as a fallback when using the application manager.
  run: "/bin/bash -lc 'export USE_FALLBACK=1 && source .venv/bin/activate && gunicorn -b 0.0.0.0:$PORT app_improved:app'"
